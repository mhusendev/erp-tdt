import{D as v}from"./Default-qlqlDK0L.js";import{_ as x}from"./Icon-2n2d9mqB.js";import{u as I}from"./projects-q85NjqVL.js";import{u as k}from"./customers-tAzfInPv.js";import{_ as V,f as p,S,c as P,w as u,r as n,o as h,b as c,a as i,j as b,d as B,p as O,k as T}from"./index-YS2kazAn.js";import{D as L}from"./DataTable-cG1mwlIC.js";import{B as A}from"./Button-sqPc1nzK.js";import{P as N}from"./Pagination-eYLTHK5w.js";import{L as E}from"./Loading-X19ktdnh.js";import{I as J}from"./InputField-inxCe4wh.js";import{M as F}from"./Modal-ZjWr7JwA.js";import{s as U}from"./default.css_vue_type_style_index_0_src_true_lang-ex5BB7O5.js";const a=I(),m=k(),R={name:"project",components:{Icon:x,Default:v,Button:A,DataTable:L,Pagination:N,Loading:E,InputField:J,Modal:F,Multiselect:U},data(){return{label_head:p(a.headers),loading:!1,currentPage:p(a.currentPage),totalPages:p(a.totalPage),body:p(a.data_projects),ProjectModel:{project_name:"",customer_pic_id:"",customer_id:""},btnMode:"",isModalOpen:!1,disablePIC:!0}},mounted(){a.getData(this.currentPage),this.getData()},methods:{async extractJsonObject(e){return await e.map(({project_name:s,project_code:d,progress:o,customer:l,customer_pic:_})=>({project_name:s,project_code:d,progress:Math.ceil(o/9*100)+"%",customer:l.customer_name,customr_pic:_.contact_name}))},async handlePageChange(e){this.currentPage=await e,this.getData()},async getData(){this.loading=!0,await a.getData(this.currentPage),this.currentPage=await a.currentPage,this.totalPages=await a.totalPage,console.log(this.totalPages),this.body=await this.filterDataforTable(),await this.body.forEach(e=>{let t=Object.keys(e);this.label_head=t}),this.loading=!1},async showModal(e,t){e==="add"?(this.btnMode="New project",this.isModalOpen=!0,this.disablePIC=!0):(this.btnMode="edit",console.log(t))},async actionToBackend(e){this.loading=!0,e==="New project"&&(await a.PostData(this.ProjectModel),this.ProjectModel.project_name="",await a.getData(this.currentPage),await this.getData(),m.$reset(),this.isModalOpen=!1),e==="edit"&&(await a.PutData(this.ProjectModel),this.isModalOpen=!1,this.ProjectModel.project_name="",await a.getData(this.currentPage),this.getData())},closeModal(){this.isModalOpen=!1},async filterDataforTable(){const e=["createdAt","updatedAt","history","is_deleted","customer_id","customer_pic_id","project_id","sales_id","created_by"],t=await a.data_projects.map(d=>Object.fromEntries(Object.entries(d).filter(([l])=>!e.includes(l))));return await this.extractJsonObject(t)},handleEdit(e){this.btnMode="edit",this.ProjectModel.project_id=e.project_id,this.ProjectModel.project_name=e.project_name,this.isModalOpen=!0,console.log(e)},async handleDelete(e){this.btnMode="delete",console.log(e),this.ProjectModel.project_id=await e.project_id,new S({title:"hapus?",text:"data tidak akan bisa kembali!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then(t=>{t.isConfirmed&&(this.loading=!0,a.DeleteData(this.ProjectModel),this.ProjectModel.project_name="",this.getData())})},async Customer(e){return await m.Search(e),await m.dataSearch.map(t=>({value:t.customer_id,label:t.customer_name}))},filterJsonArray(e,t){return e.filter(s=>s.customer_id.toLowerCase().includes(t.toLowerCase()))},async CustomerPIC(e){return await m.SearchPIC(e),await(await this.filterJsonArray(m.dataSearchPIC,this.ProjectModel.customer_id)).map(s=>({value:s.customer_pic_id,label:s.contact_name}))},handleView(e,t){let s=a.data_projects.find((d,o)=>o===e);a.$patch(d=>{d.dataEdit=s}),this.$router.push("/projects/detail/"+s.project_id)}},computed:{},created(){}},j=e=>(O("data-v-5e370b1e"),e=e(),T(),e),Y={class:"h-fit px-10 py-10 w-[700px]"},q={class:"px-5 py-5 border rounded-lg w-full mt-3"},z={class:"px-5 py-5 border rounded-lg w-full mt-3"},G={class:"flex mt-10 justify-end"},H={class:"col-span-12 mt-3 px-10 py-5"},K=j(()=>i("h1",{class:"text-lg border-b border-slate-900 font-semibold w-fit pr-6 mb-10"},"Projects",-1)),Q=j(()=>i("div",{class:"intro-y block sm:flex items-center h-10"},[i("div",{class:"flex items-center justify-center sm:ml-auto mt-3 mr-5 sm:mt-0"})],-1)),W={key:1};function X(e,t,s,d,o,l){const _=n("InputField"),f=n("Multiselect"),g=n("Button"),w=n("Modal"),M=n("Loading"),y=n("DataTable"),C=n("Pagination"),D=n("Default");return h(),P(D,null,{default:u(()=>[c(w,{show:o.isModalOpen,modalType:"primary",modalLabel:o.btnMode,onCloseModal:l.closeModal},{default:u(()=>[i("div",Y,[i("div",null,[c(_,{type:"text",class:"w-full",placeholder:"Project Name",modelValue:o.ProjectModel.project_name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.ProjectModel.project_name=r)},null,8,["modelValue"]),i("div",q,[c(f,{placeholder:"Select Customer",modelValue:o.ProjectModel.customer_id,"onUpdate:modelValue":t[1]||(t[1]=r=>o.ProjectModel.customer_id=r),options:l.Customer,"filter-results":!1,"resolve-on-load":!1,delay:0,searchable:!0,onSelect:t[2]||(t[2]=r=>o.disablePIC=!1),onDeselect:t[3]||(t[3]=r=>o.disablePIC=!0),class:"multiselect-blue w-full","close-on-select":!0},null,8,["modelValue","options"])]),i("div",z,[c(f,{disabled:o.disablePIC,placeholder:"Select Customer PIC",modelValue:o.ProjectModel.customer_pic_id,"onUpdate:modelValue":t[4]||(t[4]=r=>o.ProjectModel.customer_pic_id=r),options:l.CustomerPIC,"filter-results":!1,"resolve-on-load":!1,delay:0,searchable:!0,class:"multiselect-blue w-full","close-on-select":!0},null,8,["disabled","modelValue","options"])])]),i("div",G,[c(g,{type:"success",onClick:t[5]||(t[5]=r=>l.actionToBackend(this.btnMode))},{default:u(()=>[b("Save")]),_:1})])])]),_:1},8,["show","modalLabel","onCloseModal"]),i("div",H,[K,Q,o.loading?(h(),P(M,{key:0})):(h(),B("div",W,[c(y,{theads:o.label_head,items:o.body,btnView:!0,onView:l.handleView},{default:u(()=>[c(g,{type:"primary",onClick:t[6]||(t[6]=r=>l.showModal("add",null)),icon_name:"Plus",icon_position:"left"},{default:u(()=>[b("New projects ")]),_:1})]),_:1},8,["theads","items","onView"]),c(C,{"current-page":o.currentPage,"total-pages":o.totalPages,"visible-page-count":5,onPageChange:l.handlePageChange},null,8,["current-page","total-pages","onPageChange"])]))])]),_:1})}const de=V(R,[["render",X],["__scopeId","data-v-5e370b1e"]]);export{de as default};
